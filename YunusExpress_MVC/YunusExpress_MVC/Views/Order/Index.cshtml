@using YunusExpress_MVC.Models
@using YunusExpress_MVC.ViewModels
@model List<Order>

@{
    ViewData["Title"] = "Sifariş Siyahısı";
}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap Və Dəyiş</title>
    <link rel="stylesheet" href="~/assets/style/reset.css">
    <link rel="stylesheet" href="~/assets/style/findAndChange.css">
</head>
<body>
    <div class="container">
            <div class="form-heading">
            <form method="get" action="/Order/Index">
                <div class="form-heading">
                    <div style="display: flex;">
                        <div>
                            <!-- Göndərən -->
                            <div class="text-section" style="width: 350px;">
                                <label class="text-label">Göndərən</label>
                                <select id="senderDropdown" name="clientCode" class="text-input" style="width: 150px;"></select>
                                <input type="text" id="receiverNameInput" name="receiverName" class="text-input" readonly />
                            </div>

                            <!-- Kuryer -->
                            <div class="text-section" style="width: 350px;">
                                <label class="text-label">Kuryer</label>
                                <select id="courierDropdown" name="courierCode" class="text-input" style="width: 150px;"></select>
                                <input type="text" id="courierNameInput" name="courierName" class="text-input" readonly />
                            </div>
                        </div>

                        <!-- Tarix -->
                        <div style="margin: 0 0 0 50px;">
                            <div style="width: 150px;margin:0 0 5px 0">
                                <input type="date" class="text-input" name="startDate" />
                                <p style="display: inline;">-dən</p>
                            </div>
                            @*  <div style="width: 150px;">
                            <input type="date" class="text-input" name="endDate" />
                            <p style="display: inline;">-dək</p>
                            </div> *@
                        </div>
                    </div>

                    <!-- Filter növü -->
                    <div class="radios">
                        <div class="radio-section">
                            <input type="radio" class="radio-input" id="all" name="type" value="all" checked />
                            <label class="radio-label" for="all">Hamısı</label>
                        </div>

                        <div class="radio-section">
                            <input type="radio" class="radio-input" id="waybil" name="type" value="waybil" />
                            <label class="radio-label" for="waybil">waybill - 0</label>
                        </div>
                    </div>

                    <button type="submit">Filtrlə</button>
                </div>
            </form>
            <script>
                document.addEventListener("DOMContentLoaded", async () => {
                    // Göndərənlər üçün məlumat al
                    const senderDropdown = document.getElementById("senderDropdown");
                    const receiverInput = document.getElementById("receiverNameInput");

                    const courierDropdown = document.getElementById("courierDropdown");
                    const courierInput = document.getElementById("courierNameInput");

                    try {
                        const senderResponse = await fetch("/Order/GetSenders");
                        const senderData = await senderResponse.json();

                        senderData.forEach(s => {
                            const option = document.createElement("option");
                            option.value = s.clientCode;
                            option.textContent = `${s.clientCode} - ${s.receiverName}`;
                            option.dataset.receiverName = s.receiverName;
                            senderDropdown.appendChild(option);
                        });

                        const courierResponse = await fetch("/Order/GetCouriers");
                        const courierData = await courierResponse.json();

                        courierData.forEach(c => {
                            const option = document.createElement("option");
                            option.value = c.courierCode;
                            option.textContent = `${c.courierCode} - ${c.courierName}`;
                            option.dataset.courierName = c.courierName;
                            courierDropdown.appendChild(option);
                        });
                    } catch (err) {
                        console.error("Xəta baş verdi:", err);
                    }

                    senderDropdown.addEventListener("change", function () {
                        const selected = this.selectedOptions[0];
                        receiverInput.value = selected.dataset.receiverName || "";
                    });

                    courierDropdown.addEventListener("change", function () {
                        const selected = this.selectedOptions[0];
                        courierInput.value = selected.dataset.courierName || "";
                    });
                });
            </script>

            
                <div style="width: 250px;display: flex;">
                    <button class="today-btn">Bu gün</button>
                </div>
            </div>
            <div class="form-table">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th class="column-sifaris">Sifarişin No</th>
                            <th class="column-gonderen">Göndərən</th>
                            <th class="column-waybill">Waybill</th>
                            <th class="column-paylanma">Paylanma</th>
                            <th class="column-tarix">Tarix</th>
                            <th class="column-nov">Növ</th>
                            <th class="column-kuryer">Kuryer</th>
                            <th class="column-gonderen-unvan">Göndərənin Ünvanı</th>
                            <th class="column-alici">Alıcı</th>
                            <th class="column-alici-unvan">Alıcının Ünvanı</th>
                            <th class="column-mebleg">Məbləğ</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.SenderName</td>
                                <td>@item.InvoiceNo</td>
                                <td><input type="checkbox" readonly></td>
                                <td>@item.StartDate</td>
                                <td>@item.ServiceType!.ServiceType</td>
                                <td>@item.Courier!.CourierName</td>
                                <td>@item.SenderAddress</td>
                                <td>@item.ReceiverName</td>
                                <td>@item.ReceiverAddress</td>
                                <td>$10</td>
                            </tr>
                        }
                        <!-- Add more rows as needed -->
                    </tbody>
                </table>
            </div>
            <div class="back-btn">
                <a asp-action="Index" asp-controller="Home">⬅</a>
            </div>
    </div>
</body>

</html>