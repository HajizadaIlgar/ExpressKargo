@using YunusExpress_MVC.Models
@using YunusExpress_MVC.ViewModels
@model List<Order>

@{
    ViewData["Title"] = "Sifariş Siyahısı";
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap Və Dəyiş</title>
    <link rel="stylesheet" href="~/assets/style/reset.css">
    <link rel="stylesheet" href="~/assets/style/findAndChange.css">
</head>
<body>
    <div class="container">
            <div class="form-heading">
            <form method="get" id="filterForm">
                <div style="display: flex;">
                    <div>
                        <div class="text-section" style="width: 300px; display: flex; align-items: center;">
                            <label class="text-label" style="margin-right: 10px;">Göndərən Kodu:</label>


                            @Html.DropDownList(
                                     "senderName",
                                     ViewBag.Senders as List<SelectListItem>,
                                     "Hamisi",
                                     new
                                     {
                                         id = "senderDropdown",
                                         @class = "text-input",
                                         style = "width:60px;",
                                         onchange = "this.form.submit()"
                                     }
                                     )

                            <input type="text"
                                   id="senderDisplay"
                                   class="text-input"
                                   style="width:150px;margin:8px"
                                   readonly
                                   placeholder="Ad" />
                        </div>


                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const dd = document.getElementById("senderDropdown");
                                const displayInput = document.getElementById("senderDisplay");
                                const namesMap = @Html.Raw(Json.Serialize(ViewBag.SenderNames));

                                function updateDisplay() {
                                    const code = dd.value;
                                    if (!code) {
                                        displayInput.value = "";
                                    } else {
                                        const name = namesMap[code] || "";
                                        displayInput.value = `${name} ${code}`;
                                    }
                                }

                                dd.addEventListener("change", updateDisplay);

                                // Əgər səhifə yüklənəndə artıq seçim varsa, göstər
                                updateDisplay();
                            });
                        </script>

                        <div class="text-section" style="display: flex; align-items: center; gap: 10px;">
                            <label class="text-label">Kuryer</label>

                            @Html.DropDownList(
                                     "courierName",
                                     ViewBag.Couriers as List<SelectListItem>,
                                     "Hamısı",
                                     new
                                     {
                                         @class = "text-input",
                                         style = "width: 55px;",
                                         id = "courierDropdown",
                                         onchange = "this.form?.submit()" // Avtomatik filterləmək üçün (istəyə bağlı)
                                     }
                                     )

                            <input type="text" id="courierNameDisplay" class="text-input" style="width: 150px;" readonly />
                        </div>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const dropdown = document.getElementById("courierDropdown");
                                const nameInput = document.getElementById("courierNameDisplay");

                                // Serverdən gələn KOD → AD dictionary
                                const courierNames = @Html.Raw(Json.Serialize(ViewBag.CourierNames));

                                function updateCourierName() {
                                    const code = dropdown.value;
                                    nameInput.value = courierNames[code] || "";
                                }

                                dropdown.addEventListener("change", updateCourierName);

                                // Yüklənəndə əvvəlcədən seçilmiş dəyəri göstər
                                updateCourierName();
                            });
                        </script>

                    </div>

                    <form method="get" asp-action="Index" id="filterForm">
                        <div style="display: flex; gap: 50px; align-items: center;">
                            <label>Başlanğıc:</label>
                            <input type="date" name="startDate" id="startDate" class="text-input"
                                   value="@@(Request.Query["startDate"])" />

                            <label>Bitmə:</label>
                            <input type="date" name="endDate" id="endDate" class="text-input"
                                   value="@@(Request.Query["endDate"])" />

@*                             <button type="submit" class="btn-submit">Filtrlə</button>
 *@                        </div>
                    </form>

                    <div style="margin-left:30px" class="radios">
                            <div class="radio-section">
                                <input type="radio" name="type" onchange="this.form.submit()" value="all" (Request.Query["type"]= ="all" ? "checked" : "" ) />
                                <label class="radio-label" for="all">Hamısı</label>
                            </div>
                        <div class="radio-section">
                           
                        </div>
                        <div class="radio-section">
                           
                        </div>
                            <div class="radio-section">
                                <input type="radio" name="type" value="waybill" onchange="this.form.submit()" (Request.Query["type"]= ="waybill" ? "checked" : "" ) />
                                <label class="radio-label" for="waybil">Waybill - 0</label>
                            </div>
                    </div> 
                    <div style="margin-left: 20px;">
@*                         <button type="submit" class="btn btn-primary">Filtrlə</button>
 *@                    </div>
                </div>
            </form>


            <div style="width: 250px; display: flex;">
                <button class="today-btn" id="todayFilterBtn" type="button">Bu gün</button>
            </div>
            <script>
                document.getElementById("todayFilterBtn").addEventListener("click", function () {
                    const today = new Date();
                    const yyyy = today.getFullYear();
                    const mm = String(today.getMonth() + 1).padStart(2, '0'); // Aylar 0-dan başlayır
                    const dd = String(today.getDate()).padStart(2, '0');

                    const formattedDate = `${yyyy}-${mm}-${dd}`;

                    // İstəyə uyğun digər filterlər varsa saxlayırıq
                    const params = new URLSearchParams(window.location.search);

                    params.set("startDate", formattedDate);
                    // Əlavə filterləri silmək istəyirsənsə, params.delete("senderName") və s. yaz

                    // Yeni URL-ə yönləndir
                    window.location.href = `/Order?${params.toString()}`;
                });
            </script>

            </div>
            <div class="form-table">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th class="column-sifaris">Sifarişin No</th>
                            <th class="column-gonderen">Göndərən</th>
                            <th class="column-waybill">Waybill</th>
                            <th class="column-paylanma">Paylanma</th>
                            <th class="column-tarix">Tarix</th>
                            <th class="column-nov">Növ</th>
                            <th class="column-kuryer">Kuryer</th>
                            <th class="column-gonderen-unvan">Göndərənin Ünvanı</th>
                            <th class="column-alici">Alıcı</th>
                            <th class="column-alici-unvan">Alıcının Ünvanı</th>
                            <th class="column-mebleg">Məbləğ</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.ReceiverName</td>
                                <td>@item.InvoiceNo</td>
                                <td><input type="checkbox" readonly></td>
                                <td>@item.StartDate</td>
                                <td>@item.ServiceType!.ServiceType</td>
                                <td>@item.ToCourier!.CourierName</td>
                                <td>@item.ReceiverAddress</td>
                                <td>@item.SenderName</td>
                                <td>@item.SenderAddress</td>
                                <td>$10</td>
                            </tr>
                        }
                        <!-- Add more rows as needed -->
                    </tbody>
                </table>
            </div>
            <div class="back-btn">
                <a asp-action="Index" asp-controller="Home">⬅</a>
            </div>
    </div>
</body>

</html>